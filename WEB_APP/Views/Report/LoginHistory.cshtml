
@using DATA.Models
@{
    ViewBag.Title = "Login History Report";
    var roles = ViewBag.Roles as List<AppRole>;
}

<div class="row">
    <div class="col-lg-12">
        <!-- small box -->
        <div class="card card-primary">
            <div class="card-header">
                <h3 class="card-title">Login History Report</h3>
            </div>
            <!-- /.card-header -->
            <div class="card-body">
                <div class="col-sm-3">
                    <div class="form-group">
                        <label for="roleDropdown">Select Role</label>
                        <select id="roleDropdown" class="form-control">
                            @foreach (var role in roles)
                            {
                                <option value="@role.Id">@role.Name</option>
                            }
                        </select>
                    </div>
                </div>
                
                <div id="login_history_view_all">
                </div>
            </div>
            <!-- /.card-body -->
        </div>
    </div>
</div>

@section scripts {
    <script>
        $(document).ready(function () {
            $('#roleDropdown').change(function () {
                LoadReportTable();
            });
            LoadReportTable();
        });
        function LoadReportTable() {
            var selectedRole = $('#roleDropdown').val();
            console.log($('#roleDropdown').val())
            $.ajax({
                url: "@Url.Action("GetLoginHistoryReport")",
                type: 'GET',
                data: { roleId: selectedRole },
                dataType: 'json', // added data type
                success: function (res) {
                  
                    if (res.is_valid) {
                        $('#login_history_view_all').html(res.html);
                        activatejQueryTable();
                    }
                }
            });
        }
        function activatejQueryTable() {
            $("#loginhistoryTable").DataTable({
                "order": [],
                "responsive": true, "lengthChange": true, "autoWidth": false,
                "buttons": ["copy", "csv", "excel", "print", "colvis"]
            }).buttons().container().appendTo('#loginhistoryTable_wrapper .col-md-6:eq(0)');
        }
    </script>
}
