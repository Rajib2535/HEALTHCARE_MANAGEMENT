@{
    ViewBag.Title = "User Registration Summary Report";
}

<style>
    .bootstrap-datetimepicker-widget .datepicker-days table td,
    .bootstrap-datetimepicker-widget .datepicker-days table th {
        font-size: 12px;
    }
</style>

<div class="row">
    <div class="col-lg-12">
        <!-- Card container -->
        <div class="card card-primary">
            <div class="card-header">
                <h3 class="card-title">User Registration Summary Report</h3>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-sm-3">
                        <div class="form-group">
                            <label>From Date:</label>
                            <div class="input-group date" data-target-input="nearest">
                                <input type="text" readonly="readonly" id="txtFromDate" class="form-control form-control-sm datetimepicker-input" />
                                <div class="input-group-append" data-target="#txtFromDate" data-toggle="datetimepicker">
                                    <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-3">
                        <div class="form-group">
                            <label>To Date:</label>
                            <div class="input-group date" data-target-input="nearest">
                                <input type="text" readonly="readonly" id="txtToDate" class="form-control form-control-sm datetimepicker-input" />
                                <div class="input-group-append" data-target="#txtToDate" data-toggle="datetimepicker">
                                    <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-2 d-flex align-items-end mb-3">
                        <button type="button" class="btn btn-primary btn-block" id="btnSearch">Search</button>
                    </div>
                </div>
                <br />
                <!-- Divs for dynamically populated reports -->
                <div id="transaction_summary_report_view_all"></div>
                <br />
                <div id="user_summary_report_view_all"></div>
            </div>
        </div>
    </div>
</div>

@section scripts {
    <script>
        $(document).ready(function () {
            initializeDatePickers();
            loadReports();
            bindSearchButton();
        });
        function initializeDatePickers() {
            $('#txtFromDate').datetimepicker({
                format: 'DD-MMM-YYYY',
                defaultDate: new Date(),
                ignoreReadonly: true,
            });
            $('#txtToDate').datetimepicker({
                format: 'DD-MMM-YYYY',
                defaultDate: new Date(),
                ignoreReadonly: true,
            });
        }
        function bindSearchButton() {
            $('#btnSearch').click(function () {
                loadReports();
            });
        }
        function loadReports() {
            const searchParams = {
                startDate: $('#txtFromDate').val(),
                endDate: $('#txtToDate').val()
            };
            loadCardReport('@Url.Action("GetStatusWiseUserCount")', '#transaction_summary_report_view_all', searchParams);
            loadTableReport('@Url.Action("GetUserRegistrationSummary")', '#user_summary_report_view_all', '#userRegistrationSummaryTable', searchParams);
        }
        function loadCardReport(url, containerId, searchParams) {
            $.ajax({
                type: 'POST',
                dataType: 'JSON',
                url: url,
                data: jQuery.param(searchParams),
                success: function (response) {
                    $(containerId).html(response.html);
                },
                error: function (response) {
                    console.error("Error loading card report:", response);
                    alert("Failed to load status-wise user count report.");
                }
            });
        }
        function loadTableReport(url, containerId, tableId, searchParams) {
            $.ajax({
                type: 'POST',
                dataType: 'JSON',
                url: url,
                data: jQuery.param(searchParams),
                success: function (response) {
                    $(containerId).html(response.html);
                    initializeDataTable(tableId);
                },
                error: function (response) {
                    console.error("Error loading table report:", response);
                    alert("Failed to load user registration summary report.");
                }
            });
        }
        function initializeDataTable(tableId) {
            $(tableId).DataTable({
                order: [],
                responsive: true,
                lengthChange: true,
                autoWidth: false,
                buttons: ["copy", "csv", "excel", "print", "colvis"]
            }).buttons().container().appendTo(tableId + '_wrapper .col-md-6:eq(0)');
        }
    </script>
}
